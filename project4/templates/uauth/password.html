{% block title %}비밀번호 재설정{% endblock title %}

{% block content %}
<div class="rpnew">
  <div class="rpnew__backdrop" role="dialog" aria-modal="true" aria-labelledby="rpnewTitle">
    <div class="rpnew__card">
      <div class="rpnew__head">
        <a class="rpnew__icon" href="javascript:history.back()" aria-label="뒤로">←</a>
        <div class="rpnew__spacer"></div>
        <a class="rpnew__icon" href="{% url 'uauth:login' %}" aria-label="닫기">×</a>
      </div>

      <div class="rpnew__body">
        <!-- ✅ 폼으로 감싸기: POST /app/password/ -->
        <form id="pwForm" method="post" action="{% url 'uauth:password' %}">
          {% csrf_token %}

          <div class="rpnew__group">
            <label class="rpnew__label" for="pw1">비밀번호 입력</label>
            <!-- ✅ name 속성 추가 -->
            <input id="pw1" name="password1" class="rpnew__field" type="password"
                   placeholder="새 비밀번호" autocomplete="new-password" required />
          </div>

          <div class="rpnew__group">
            <label class="rpnew__label" for="pw2">비밀번호 재입력</label>
            <!-- ✅ name 속성 추가 -->
            <input id="pw2" name="password2" class="rpnew__field" type="password"
                   placeholder="새 비밀번호 재입력" autocomplete="new-password" required />
          </div>

          <div class="rpnew__hint">
            <strong>비밀번호 입력하실 때는 아래 사항을 지켜주세요.</strong>
            <ul>
              <li>비밀번호는 최소 5자 이상 포함</li>
              <li>최대 16자 제한</li>
              <li>영문 대/소문자 포함</li>
              <li>숫자 포함</li>
              <li>특수문자 중 2종류 이상 포함</li>
            </ul>
          </div>

          <!-- ✅ type="submit" 이어야 서버로 POST 됩니다 -->
          <button id="rpnewSubmit" type="submit" class="rpnew__btn">비밀번호 저장</button>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
  /* (스타일은 기존 그대로) */
  .rpnew{position:relative;min-height:60vh}
  .rpnew__backdrop{position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.72); padding:20px; z-index:30;}
  .rpnew__card{width:min(520px, 92vw); background:#e0e0e0; border-radius:20px; box-shadow:0 20px 60px rgba(0,0,0,.45), 0 0 0 1px rgba(255,255,255,.06) inset; overflow:hidden; animation: rp-pop .18s ease-out;}
  @keyframes rp-pop{from{opacity:.5; transform:translateY(6px) scale(.98)} to{opacity:1; transform:none}}
  .rpnew__head{height:48px; display:flex; align-items:center; gap:8px; padding:0 10px; background:#e8e8e8; border-bottom:1px solid #d8d8d8;}
  .rpnew__spacer{flex:1}
  .rpnew__icon{width:36px; height:36px; border-radius:10px; display:grid; place-items:center; background:#f6f6f6; border:1px solid #d8d8d8; cursor:pointer; text-decoration:none; color:#111; font-size:20px; user-select:none;}
  .rpnew__icon:active{transform:translateY(1px)}
  .rpnew__body{padding:20px 24px 24px}
  .rpnew__group{display:grid; gap:8px; margin-top:10px}
  .rpnew__label{font-weight:800}
  .rpnew__field{height:54px; border-radius:12px; border:1px solid #cfcfcf; background:#efefef; padding:0 14px; font-size:16px; outline:none;}
  .rpnew__field:focus{box-shadow:0 0 0 2px rgba(0,0,0,.08) inset}
  .rpnew__hint{margin:14px 2px 8px; font-size:13px; color:#111;}
  .rpnew__hint ul{margin:6px 0 0 18px; padding:0}
  .rpnew__hint li{margin:4px 0}
  .rpnew__btn{margin-top:14px; width:100%; height:58px; border-radius:12px; border:1px solid #cfcfcf; background:#9c9c9c; color:#fff; font-weight:900; font-size:18px; cursor:pointer;}
  .rpnew__btn:hover{background:#8b8b8b}
  .rpnew__btn:active{transform:translateY(1px)}
  @media (max-width:480px){.rpnew__body{padding:18px}.rpnew__field{height:50px}.rpnew__btn{height:54px; font-size:17px}}
</style>

<script>
  (function(){
    const form = document.getElementById('pwForm');
    const pw1  = document.getElementById('pw1');
    const pw2  = document.getElementById('pw2');
    const btn  = document.getElementById('rpnewSubmit');

    // (선택) 간단한 프런트 검증만 하고 폼 제출
    form.addEventListener('submit', function(e){
      const v1 = pw1.value.trim();
      const v2 = pw2.value.trim();

      if (v1.length < 5 || v1.length > 16) {
        e.preventDefault();
        alert('비밀번호 길이는 5~16자여야 합니다.');
        return;
      }
      if (v1 !== v2) {
        e.preventDefault();
        alert('두 비밀번호가 일치하지 않습니다.');
        return;
      }
      // 여기서 e.preventDefault() 안 하면 실제로 서버로 POST 전송됨
      // 서버(view.password)에서 DB에 set_password()/create_user() 저장 처리
      btn.disabled = true; btn.style.opacity = .6;
    });

    // Enter 키 제출은 폼 기본 동작으로 그대로 됩니다.
  })();
</script>
{% endblock content %}